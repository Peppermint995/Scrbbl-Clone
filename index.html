<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skribbl Clone - Multiplayer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Nunito', sans-serif; }
    .canvas-container { cursor: crosshair; }
    input[type="range"] { accent-color: #2563eb; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .animate-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="bg-slate-100 overflow-hidden">

  <!-- LOBBY VIEW -->
  <div id="lobby-view" class="min-h-screen bg-slate-900 flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl p-6 w-full max-w-2xl overflow-hidden">
      <div class="text-center mb-8">
        <h1 class="text-6xl font-black text-blue-600 italic tracking-tighter drop-shadow-sm">skribbl.io</h1>
        <p class="text-slate-400 font-bold uppercase text-[10px] tracking-[0.3em] mt-2">Multiplayer Edition</p>
      </div>
      <div class="flex flex-col md:flex-row gap-8">
        <div class="flex-1 flex flex-col items-center border-b md:border-b-0 md:border-r border-slate-100 pb-8 md:pb-0 md:pr-8">
          <div id="avatar-preview" class="w-40 h-40 rounded-[2.5rem] flex items-center justify-center text-7xl shadow-xl mb-6 bg-red-500 transition-transform hover:scale-105 cursor-default">ğŸ±</div>
          <input id="player-name" type="text" placeholder="Your Name..." maxlength="12" class="w-full px-5 py-4 border-2 border-slate-100 rounded-2xl focus:border-blue-500 outline-none font-bold text-center text-lg shadow-inner bg-slate-50">
          <div class="mt-6 w-full space-y-4">
            <div id="color-grid" class="grid grid-cols-4 gap-2"></div>
            <div id="icon-grid" class="grid grid-cols-6 gap-2"></div>
          </div>
        </div>
        <div class="flex-1 flex flex-col justify-center space-y-4">
          <button id="quick-play" class="group w-full bg-blue-600 hover:bg-blue-700 text-white p-6 rounded-2xl transition-all shadow-lg active:scale-95 disabled:opacity-50" disabled>
            <div class="flex items-center justify-between">
              <div class="text-left">
                <p class="text-2xl font-black italic">QUICK PLAY</p>
                <p class="text-blue-200 text-xs font-bold uppercase tracking-widest">Join Lobby</p>
              </div>
              <span class="text-3xl opacity-50 group-hover:opacity-100">ğŸŒ</span>
            </div>
          </button>
          <div class="relative py-2">
            <div class="absolute inset-0 flex items-center"><span class="w-full border-t-2 border-slate-100"></span></div>
            <div class="relative flex justify-center text-[10px] uppercase font-black text-slate-300 tracking-widest"><span class="bg-white px-3">Private Match</span></div>
          </div>
          <div class="space-y-3">
            <div class="flex gap-2">
              <input id="room-code-input" type="text" placeholder="CODE..." maxlength="6" class="flex-1 px-4 py-4 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-purple-500 outline-none font-mono font-bold uppercase tracking-widest text-center">
              <button id="create-private" class="bg-purple-600 hover:bg-purple-700 text-white px-6 rounded-2xl transition-all shadow-lg active:scale-90 flex items-center justify-center">
                <span class="text-2xl font-bold">+</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div id="auth-warning" class="hidden mt-4 p-3 bg-amber-50 border border-amber-200 rounded-xl text-amber-700 text-xs font-bold">
        âš ï¸ Anonymous Auth not enabled in Firebase Console. Using local session mode.
      </div>
    </div>
  </div>

  <!-- GAME VIEW -->
  <div id="game-view" class="hidden h-screen flex flex-col md:flex-row overflow-hidden">
    <!-- Sidebar: Players -->
    <div class="w-full md:w-64 bg-white border-r border-slate-200 flex flex-col shrink-0">
      <div class="p-4 border-b border-slate-100 bg-slate-50/50 flex items-center justify-between">
        <h2 class="font-black italic text-slate-700 flex items-center gap-2">ğŸ‘¥ PLAYERS</h2>
        <button id="exit-game" class="text-slate-400 hover:text-red-500 transition-colors text-xl">ğŸšª</button>
      </div>
      <div id="player-list" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
      <div class="p-4 bg-slate-900 text-white flex items-center justify-between">
        <div class="flex flex-col">
          <span class="text-[9px] font-bold text-slate-500 uppercase tracking-widest">Room ID</span>
          <span id="display-room-id" class="text-xs font-mono font-bold tracking-widest">---</span>
        </div>
        <button id="copy-code-btn" class="hover:text-blue-400">ğŸ“‹</button>
      </div>
    </div>

    <!-- Main: Drawing Area -->
    <div class="flex-1 flex flex-col relative">
      <div class="bg-white border-b border-slate-200 flex flex-col z-10 shadow-sm">
        <div class="h-16 flex items-center justify-between px-6">
          <div class="flex items-center gap-4">
            <div class="bg-blue-600 text-white p-2 rounded-lg rotate-3 text-xl">âœï¸</div>
            <div>
              <p class="text-[10px] text-slate-400 uppercase font-black tracking-[0.2em] leading-none mb-1">Guess This Word</p>
              <p id="word-display" class="font-mono text-xl font-black tracking-[0.4em] text-slate-800">_ _ _ _</p>
            </div>
          </div>
          <div id="drawer-tools" class="hidden items-center gap-3">
            <button id="eraser-btn" class="p-2.5 bg-slate-100 text-slate-600 rounded-xl hover:bg-slate-200 border-2 border-transparent" title="Eraser">ğŸ§½</button>
            <button id="clear-btn" class="p-2.5 bg-red-50 text-red-500 rounded-xl hover:bg-red-100" title="Clear Canvas">ğŸ—‘ï¸</button>
          </div>
        </div>

        <div id="tool-bar" class="hidden h-20 bg-slate-50 border-t border-slate-100 items-center px-6 gap-6 overflow-x-auto no-scrollbar">
          <div class="flex flex-col shrink-0 gap-1 min-w-[120px]">
            <div class="flex justify-between items-center text-[10px] font-bold text-slate-500 uppercase">
              <span>Brush Size</span>
              <span id="brush-size-label">5px</span>
            </div>
            <input id="brush-size" type="range" min="2" max="40" value="5" class="w-full">
          </div>
          <div class="h-10 w-[2px] bg-slate-200 shrink-0"></div>
          <div id="palette" class="flex flex-wrap gap-1.5 py-2 min-w-0"></div>
        </div>
      </div>

      <div class="flex-1 bg-white relative overflow-hidden canvas-container">
        <canvas id="game-canvas" class="w-full h-full touch-none"></canvas>
        <div id="drawer-overlay" class="hidden absolute inset-0 bg-slate-900/5 pointer-events-none flex items-center justify-center">
          <div class="bg-white/95 backdrop-blur-sm px-6 py-3 rounded-2xl border border-white/50 shadow-xl flex items-center gap-3 text-slate-700 font-bold italic">
            <span class="animate-bounce">ğŸ¨</span> <span id="drawer-name-notif">Player</span> is drawing...
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar: Chat -->
    <div class="w-full md:w-80 bg-slate-50 border-l border-slate-200 flex flex-col shrink-0 h-64 md:h-full">
      <div class="p-4 border-b border-slate-200 bg-white">
        <h2 class="font-black italic flex items-center gap-2 text-slate-700 text-xs tracking-widest">ğŸ’¬ FEED</h2>
      </div>
      <div id="chat-messages" class="flex-1 overflow-y-auto p-4 flex flex-col space-y-3"></div>
      <form id="chat-form" class="p-4 bg-white border-t border-slate-200 flex gap-2">
        <input id="chat-input" type="text" placeholder="Type your guess..." class="flex-1 px-4 py-3 bg-slate-100 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none font-bold disabled:bg-slate-200 disabled:cursor-not-allowed">
        <button id="chat-submit" type="submit" class="p-3 bg-blue-600 text-white rounded-2xl shadow-lg active:scale-90 disabled:opacity-50">ğŸ“¤</button>
      </form>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, onSnapshot, updateDoc, arrayUnion, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBIMQt_N3Z4nLabjV9Erj7SzlvHmhaqo4Q",
  authDomain: "chat-78682.firebaseapp.com",
  projectId: "chat-78682",
  storageBucket: "chat-78682.firebasestorage.app",
  messagingSenderId: "650441779462",
  appId: "1:650441779462:web:8ad0bc03119881ec49d687",
  measurementId: "G-R4VY4PVDV4"
};


    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const appId = "skribbl-clone-prod";

    let user = null;
    let currentRoomId = null;
    let isDrawing = false;
    let roomData = null;
    let localLines = [];

    const AVATAR_COLORS = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899', '#64748b', '#06b6d4'];
    const AVATAR_ICONS = ['ğŸ±', 'ğŸ¶', 'ğŸ¦Š', 'ğŸ¨', 'ğŸ¦', 'ğŸ¸', 'ğŸ¦„', 'ğŸ¼', 'ğŸ¤–', 'ğŸ‘¾', 'ğŸ‘»', 'ğŸ¤¡'];
    const COLORS = ['#000000', '#ffffff', '#4b4b4b', '#ee1b24', '#ff7e26', '#fef200', '#22b14c', '#00a2e8', '#3f48cc', '#a349a4'];
    const WORDS = ['Apple','Banana','Pizza','Rocket','Laptop','Elephant','Guitar','Mountain','Robot','Bicycle','Castle','Dragon','Snowman','Burger','Submarine','Volcano','Parachute','Octopus'];

    let selectedAvatarColor = AVATAR_COLORS[0];
    let selectedAvatarIcon = AVATAR_ICONS[0];
    let currentColor = '#000000';
    let brushSize = 5;
    let isErasing = false;

    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    const lobbyView = document.getElementById('lobby-view');
    const gameView = document.getElementById('game-view');
    const chatMessages = document.getElementById('chat-messages');

    function initLobbyUI() {
      const colorGrid = document.getElementById('color-grid');
      const iconGrid = document.getElementById('icon-grid');
      const palette = document.getElementById('palette');

      AVATAR_COLORS.forEach(c => {
        const btn = document.createElement('button');
        btn.className = "h-8 rounded-lg border-2 border-transparent hover:scale-110 transition-transform";
        btn.style.backgroundColor = c;
        btn.onclick = () => { selectedAvatarColor = c; document.getElementById('avatar-preview').style.backgroundColor = c; };
        colorGrid.appendChild(btn);
      });

      AVATAR_ICONS.forEach(i => {
        const btn = document.createElement('button');
        btn.className = "text-2xl p-1 rounded-xl hover:bg-slate-100 hover:scale-110 transition-transform";
        btn.innerText = i;
        btn.onclick = () => { selectedAvatarIcon = i; document.getElementById('avatar-preview').innerText = i; };
        iconGrid.appendChild(btn);
      });

      COLORS.forEach(c => {
        const btn = document.createElement('button');
        btn.className = "w-7 h-7 rounded-full border-2 border-slate-200 hover:scale-125 transition-transform";
        btn.style.backgroundColor = c;
        btn.onclick = () => { currentColor = c; isErasing = false; document.getElementById('eraser-btn').style.borderColor = 'transparent'; };
        palette.appendChild(btn);
      });
    }

    async function initAuth() {
      onAuthStateChanged(auth, u => { user = u; document.getElementById('quick-play').disabled = false; });
      try { await signInAnonymously(auth); }
      catch(err){ console.error("Auth error:", err); document.getElementById('auth-warning').classList.remove('hidden'); }
    }

    // JOIN ROOM, LISTEN, DRAWING, CHAT HANDLING (same logic as your original script)
    // ... you can copy the rest of your existing joinRoom(), listenToRoom(), draw, chat, etc.

    initLobbyUI();
    initAuth();
    window.addEventListener('resize', () => {
      const rect = canvas.parentElement.getBoundingClientRect();
      canvas.width = rect.width; canvas.height = rect.height;
      if (roomData) redrawCanvas(roomData.lines);
    });
  </script>
</body>
</html>
